<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Scroll Black Bar Fix - Manual Test</title>
    <style>
        /* Chrome-specific scroll optimization classes from globals.css */
        .chrome-scroll-optimized {
            -webkit-overflow-scrolling: touch;
            -webkit-overscroll-behavior: contain;
            overscroll-behavior: contain;
            -webkit-overscroll-behavior-y: contain;
            overscroll-behavior-y: contain;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: scroll-position;
            -webkit-will-change: scroll-position;
            background-attachment: local;
            -webkit-background-attachment: local;
            contain: layout style paint;
        }

        .chrome-background-coverage {
            background-color: #ffffff !important;
            background-image: -webkit-linear-gradient(to bottom, #ffffff 0%, #ffffff 100%);
            background-image: linear-gradient(to bottom, #ffffff 0%, #ffffff 100%);
            background-attachment: local;
            -webkit-background-attachment: local;
            -webkit-background-size: cover;
            background-size: cover;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        .chrome-flex-optimized {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            -webkit-flex: 1 1 0%;
            flex: 1 1 0%;
            background-color: #ffffff !important;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: transform;
            -webkit-will-change: transform;
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background-color: #ffffff !important;
            -webkit-background-size: cover;
            background-size: cover;
            scroll-behavior: smooth;
            -webkit-scroll-behavior: smooth;
            -webkit-overscroll-behavior: contain;
            overscroll-behavior: contain;
        }

        body {
            background-color: #ffffff !important;
            background-attachment: local;
            -webkit-background-attachment: local;
            -webkit-overscroll-behavior: contain;
            overscroll-behavior: contain;
            -webkit-overscroll-behavior-y: contain;
            overscroll-behavior-y: contain;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .test-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #ffffff;
        }

        .header {
            background-color: #2563eb;
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .content {
            flex: 1;
            padding: 1rem;
            background-color: #ffffff;
            min-height: 100vh;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }

        .short-content {
            height: 200px;
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .long-content {
            height: 2000px;
            background: linear-gradient(to bottom, #f9fafb 0%, #e5e7eb 100%);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-pass {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-fail {
            background-color: #fef2f2;
            color: #991b1b;
        }

        .test-button {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .test-button:hover {
            background-color: #1d4ed8;
        }

        .metrics {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .metric-item {
            background-color: white;
            padding: 0.75rem;
            border-radius: 0.25rem;
            border: 1px solid #e5e7eb;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .metric-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
        }
    </style>
</head>
<body class="chrome-background-coverage">
    <div class="test-container chrome-flex-optimized">
        <header class="header">
            <h1>Chrome Scroll Black Bar Fix - Manual Test</h1>
            <p id="browser-info">Detecting browser...</p>
            <div style="margin-top: 1rem;">
                <button class="test-button" onclick="runTests()">Run Tests</button>
                <button class="test-button" onclick="scrollToBottom()">Scroll to Bottom</button>
                <button class="test-button" onclick="scrollToTop()">Scroll to Top</button>
                <button class="test-button" onclick="testMomentumScroll()">Test Momentum</button>
            </div>
        </header>

        <main class="content chrome-scroll-optimized chrome-background-coverage" id="main-content">
            <div class="test-section">
                <h2>Test Results</h2>
                <div id="test-results">
                    <p>Click "Run Tests" to check Chrome optimizations</p>
                </div>
            </div>

            <div class="test-section">
                <h2>Test Scenario 1: Short Content (Black Bar Risk)</h2>
                <p>This section has content shorter than the viewport. In Chrome, scrolling past this content with momentum can reveal black bars from parent containers.</p>
                <div class="short-content">
                    <h3>Short Content Block</h3>
                    <p>This content is intentionally short to test Chrome's scroll boundary behavior.</p>
                    <p><strong>Test:</strong> Try scrolling down past this content with momentum (fast scroll). No black bars should appear.</p>
                </div>
            </div>

            <div class="test-section">
                <h2>Test Scenario 2: Long Content (Momentum Test)</h2>
                <p>This section has long content to test Chrome's scroll momentum and background consistency.</p>
                <div class="long-content">
                    <h3>Long Content Block</h3>
                    <p>This is a tall content block designed to test Chrome scroll momentum behavior.</p>
                    <p><strong>Test:</strong> Scroll through this content with various speeds and momentum. Background should remain consistently white.</p>
                    <div style="margin-top: 500px;">
                        <h4>Middle Section</h4>
                        <p>Continue scrolling to test momentum handling...</p>
                    </div>
                    <div style="margin-top: 500px;">
                        <h4>Near Bottom</h4>
                        <p>Almost at the bottom. Test overscroll behavior by scrolling past the end.</p>
                    </div>
                    <div style="margin-top: 400px;">
                        <h4>Bottom Section</h4>
                        <p>This is the bottom of the long content. Try overscrolling past this point.</p>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2>Test Scenario 3: Overscroll Boundaries</h2>
                <p>This is the final section. Test overscroll behavior by scrolling past this content.</p>
                <div style="background-color: #fef2f2; padding: 1rem; border-radius: 0.5rem;">
                    <h3>End of Content</h3>
                    <p><strong>Test:</strong> Scroll down past this point with momentum. Chrome should contain the overscroll and maintain white background.</p>
                    <p>No black bars or dark backgrounds should appear during overscroll.</p>
                </div>
            </div>

            <div class="metrics" id="metrics">
                <h3>Scroll Performance Metrics</h3>
                <div class="metrics-grid" id="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">Scroll Events</div>
                        <div class="metric-value" id="scroll-events">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Momentum Events</div>
                        <div class="metric-value" id="momentum-events">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Overscroll Events</div>
                        <div class="metric-value" id="overscroll-events">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Background Consistency</div>
                        <div class="metric-value" id="background-consistency">100%</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Chrome browser detection
        function isChromeBasedBrowser() {
            const userAgent = navigator.userAgent;
            const vendor = navigator.vendor;
            const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(vendor);
            const isEdge = /Edg/.test(userAgent);
            const isBrave = navigator.brave !== undefined;
            const isOpera = /OPR/.test(userAgent);
            return isChrome || isEdge || isBrave || isOpera;
        }

        // Test metrics
        let scrollEvents = 0;
        let momentumEvents = 0;
        let overscrollEvents = 0;
        let backgroundConsistencyChecks = 0;
        let backgroundConsistencyPasses = 0;

        // Initialize browser detection
        document.addEventListener('DOMContentLoaded', function() {
            const isChrome = isChromeBasedBrowser();
            const browserInfo = document.getElementById('browser-info');
            browserInfo.textContent = `Browser: ${isChrome ? '✅ Chrome-based' : '❌ Not Chrome'} | User Agent: ${navigator.userAgent.slice(0, 80)}...`;
            
            if (isChrome) {
                initializeChromeScrollTracking();
            }
        });

        // Initialize Chrome scroll tracking
        function initializeChromeScrollTracking() {
            const mainContent = document.getElementById('main-content');
            let lastScrollTime = 0;
            let lastScrollTop = 0;
            let isScrolling = false;
            let scrollTimeout;

            mainContent.addEventListener('scroll', function(event) {
                const currentTime = performance.now();
                const currentScrollTop = mainContent.scrollTop;
                const velocity = Math.abs(currentScrollTop - lastScrollTop) / (currentTime - lastScrollTime || 1);
                
                scrollEvents++;
                
                // Detect momentum scrolling (high velocity)
                if (velocity > 10) {
                    momentumEvents++;
                }
                
                // Detect overscroll
                const maxScroll = mainContent.scrollHeight - mainContent.clientHeight;
                if (currentScrollTop <= 0 || currentScrollTop >= maxScroll) {
                    overscrollEvents++;
                }
                
                // Check background consistency
                checkBackgroundConsistency();
                
                // Update metrics display
                updateMetricsDisplay();
                
                lastScrollTime = currentTime;
                lastScrollTop = currentScrollTop;
                
                // Clear scroll timeout
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 150);
            }, { passive: true });
        }

        // Check background consistency
        function checkBackgroundConsistency() {
            const mainContent = document.getElementById('main-content');
            const computedStyle = window.getComputedStyle(mainContent);
            const backgroundColor = computedStyle.backgroundColor;
            
            backgroundConsistencyChecks++;
            
            // Check if background is white
            if (backgroundColor === 'rgb(255, 255, 255)' || backgroundColor === '#ffffff' || backgroundColor === 'rgba(0, 0, 0, 0)') {
                backgroundConsistencyPasses++;
            }
        }

        // Update metrics display
        function updateMetricsDisplay() {
            document.getElementById('scroll-events').textContent = scrollEvents;
            document.getElementById('momentum-events').textContent = momentumEvents;
            document.getElementById('overscroll-events').textContent = overscrollEvents;
            
            const consistencyRate = backgroundConsistencyChecks > 0 ? 
                (backgroundConsistencyPasses / backgroundConsistencyChecks * 100).toFixed(1) : 100;
            document.getElementById('background-consistency').textContent = consistencyRate + '%';
        }

        // Run tests
        function runTests() {
            const mainContent = document.getElementById('main-content');
            const computedStyle = window.getComputedStyle(mainContent);
            const resultsDiv = document.getElementById('test-results');
            
            const tests = [
                {
                    name: 'Background Color Consistency',
                    test: () => {
                        const bgColor = computedStyle.backgroundColor;
                        return bgColor === 'rgb(255, 255, 255)' || bgColor === '#ffffff';
                    }
                },
                {
                    name: 'Overscroll Behavior Containment',
                    test: () => {
                        return computedStyle.overscrollBehavior === 'contain' || 
                               computedStyle.webkitOverscrollBehavior === 'contain';
                    }
                },
                {
                    name: 'Webkit Overflow Scrolling',
                    test: () => {
                        return computedStyle.webkitOverflowScrolling === 'touch';
                    }
                },
                {
                    name: 'Hardware Acceleration',
                    test: () => {
                        const transform = computedStyle.transform || computedStyle.webkitTransform;
                        return transform && transform !== 'none';
                    }
                },
                {
                    name: 'Will-Change Optimization',
                    test: () => {
                        const willChange = computedStyle.willChange || computedStyle.webkitWillChange;
                        return willChange && willChange.includes('scroll-position');
                    }
                },
                {
                    name: 'Background Attachment',
                    test: () => {
                        return computedStyle.backgroundAttachment === 'local';
                    }
                }
            ];
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">';
            
            tests.forEach(test => {
                const passed = test.test();
                const statusClass = passed ? 'status-pass' : 'status-fail';
                const statusText = passed ? '✅ Pass' : '❌ Fail';
                
                html += `
                    <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;">
                        <h4 style="margin-bottom: 0.5rem;">${test.name}</h4>
                        <span class="${statusClass}">${statusText}</span>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        // Scroll to bottom
        function scrollToBottom() {
            const mainContent = document.getElementById('main-content');
            mainContent.scrollTo({
                top: mainContent.scrollHeight,
                behavior: 'smooth'
            });
        }

        // Scroll to top
        function scrollToTop() {
            const mainContent = document.getElementById('main-content');
            mainContent.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Test momentum scroll
        function testMomentumScroll() {
            const mainContent = document.getElementById('main-content');
            
            // Simulate momentum scroll by rapidly changing scroll position
            let scrollPosition = mainContent.scrollTop;
            const targetPosition = scrollPosition + 1000;
            const duration = 500; // 500ms
            const startTime = performance.now();
            
            function animateScroll(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for momentum-like behavior
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const currentPosition = scrollPosition + (targetPosition - scrollPosition) * easeOut;
                
                mainContent.scrollTop = currentPosition;
                
                if (progress < 1) {
                    requestAnimationFrame(animateScroll);
                }
            }
            
            requestAnimationFrame(animateScroll);
        }
    </script>
</body>
</html>